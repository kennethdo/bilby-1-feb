# Ralph Test App Progress Log

---

## 2026-02-01 - RTA-001: Database setup with users table
- Created src/db.js with better-sqlite3 initialization, WAL mode, and users table creation
- Users table schema: id (INTEGER PK AUTOINCREMENT), email (TEXT UNIQUE NOT NULL), password_hash (TEXT NOT NULL), created_at (TEXT DEFAULT CURRENT_TIMESTAMP)
- Database file stored at data/app.db, data/ directory created automatically
- Exports db instance and initializeDatabase function
- Files changed: src/db.js, tests/db.test.js (6 tests, all passing)
---

## 2026-02-01 - RTA-002: User registration endpoint
- Created src/routes/auth.js with POST /register endpoint
- Accepts JSON body with email and password, validates both present
- Hashes password with bcryptjs (salt rounds: 10) before storing
- Returns 201 with { id, email } on success, 400 for missing fields or duplicate email
- Tests use minimal Express app with http client (no external test deps)
- Files changed: src/routes/auth.js, tests/auth.test.js (6 tests, all passing)
---

## 2026-02-01 - RTA-003: User login endpoint with JWT
- Added POST /login route to src/routes/auth.js
- Verifies email/password against database using bcrypt.compareSync
- Returns JWT token signed with JWT_SECRET (env var or hardcoded default), expires in 24h
- JWT payload contains user id and email
- Returns 401 for wrong credentials, 400 for missing fields
- Files changed: src/routes/auth.js, tests/login.test.js (6 tests, all passing, 18 total)
---

## 2026-02-01 - RTA-004: Auth middleware for protected routes
- Created src/middleware/auth.js with Bearer token extraction and JWT verification
- Attaches decoded payload to req.user on valid token
- Returns 401 for missing token, non-Bearer format, invalid/expired token, or wrong secret
- Tests use a minimal Express app with a protected test route (no database needed)
- Files changed: src/middleware/auth.js, tests/middleware.test.js (6 tests, all passing, 24 total)
---

## 2026-02-01 - RTA-005: Protected GET /api/me endpoint
- Added GET /me route to src/routes/auth.js using authMiddleware
- Queries database for user by req.user.id, returns id, email, created_at (no password_hash)
- Returns 401 if no token, invalid token, or user not found
- Tests register+login to get token, then verify authenticated access and rejection scenarios
- Files changed: src/routes/auth.js, tests/me.test.js (4 tests, all passing, 28 total)
---

## 2026-02-01 - RTA-006: App entry point wiring everything together
- Created src/index.js with Express app setup, JSON body parsing, and auth route mounting
- Auth routes mounted at /api/auth, database initialized via db module import
- Server listens on PORT env var or defaults to 3000, only starts when run directly (require.main === module)
- App exported for test usage
- Files changed: src/index.js, tests/index.test.js (6 tests, all passing, 34 total)
---
