# Ralph Sandbox - Isolated environment for autonomous Claude Code execution
# Uses bind mount at runtime so changes persist to host project directory
# But container CANNOT access anything outside the mounted workspace

FROM node:22-bookworm

# Install system tools Ralph might need
RUN apt-get update && apt-get install -y \
    git \
    jq \
    curl \
    ripgrep \
    python3 \
    python3-pip \
    && apt-get clean \
    && rm -rf /var/lib/apt/lists/*

# Install Claude Code CLI
RUN npm install -g @anthropic-ai/claude-code

# Create non-root user
RUN useradd -m -s /bin/bash ralph

# Install ralph CLI from plugin cache pattern
# The ralph binary will be bind-mounted or we copy a standalone version
COPY --chown=ralph:ralph .local/bin/ralph-docker /home/ralph/.local/bin/ralph
RUN chmod +x /home/ralph/.local/bin/ralph || true

# Set up PATH for ralph
ENV PATH="/home/ralph/.local/bin:${PATH}"

USER ralph
WORKDIR /home/ralph/workspace

# Dependencies installed at runtime via ralph-safe.sh (since workspace is bind-mounted)
ENTRYPOINT ["bash"]
